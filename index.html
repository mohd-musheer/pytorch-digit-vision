<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Digit Recognizer AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #canvas {
            border: 2px solid #4f46e5;
            background: black;
            cursor: crosshair;
            touch-action: none;
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-500 to-purple-600">

<div class="bg-white p-8 rounded-2xl shadow-2xl text-center w-full max-w-md">
    <h1 class="text-3xl font-bold mb-2">Digit AI</h1>
    <p class="text-gray-500 mb-4">Draw a digit (0â€“9)</p>

    <canvas id="canvas" width="280" height="280" class="mx-auto rounded-lg"></canvas>

    <div class="flex justify-center gap-4 mt-6">
        <button onclick="clearCanvas()" class="px-5 py-2 bg-gray-200 rounded-full font-semibold">Clear</button>
        <button onclick="predict()" class="px-5 py-2 bg-indigo-600 text-white rounded-full font-semibold">Predict</button>
    </div>

    <div id="result" class="mt-6 hidden">
        <p class="text-gray-400 uppercase text-sm">Prediction</p>
        <div id="digit" class="text-7xl font-black text-indigo-600">?</div>
    </div>
</div>

<script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let drawing = false;

    function fillBlack() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    // IMPORTANT: fill black immediately
    fillBlack();

    ctx.strokeStyle = "white";
    ctx.lineWidth = 12;
    ctx.lineCap = "round";

    canvas.addEventListener("mousedown", () => drawing = true);
    canvas.addEventListener("mouseup", () => { drawing = false; ctx.beginPath(); });
    canvas.addEventListener("mousemove", draw);

    canvas.addEventListener("touchstart", () => drawing = true);
    canvas.addEventListener("touchend", () => { drawing = false; ctx.beginPath(); });
    canvas.addEventListener("touchmove", drawTouch);

    function draw(e) {
        if (!drawing) return;
        const r = canvas.getBoundingClientRect();
        ctx.lineTo(e.clientX - r.left, e.clientY - r.top);
        ctx.stroke();
    }

    function drawTouch(e) {
        e.preventDefault();
        const t = e.touches[0];
        const r = canvas.getBoundingClientRect();
        ctx.lineTo(t.clientX - r.left, t.clientY - r.top);
        ctx.stroke();
    }

    function clearCanvas() {
        fillBlack();
        document.getElementById("result").classList.add("hidden");
    }

    async function predict() {
        const blob = await new Promise(resolve => canvas.toBlob(resolve));
        const formData = new FormData();
        formData.append("file", blob);

        const res = await fetch("/predict", {
            method: "POST",
            body: formData
        });

        const data = await res.json();
        document.getElementById("digit").innerText = data.predict;
        document.getElementById("result").classList.remove("hidden");
    }
</script>

</body>
</html>
